# Enable rewriting
RewriteEngine On

# Force primary host (uncomment if needed)
# RewriteCond %{HTTP_HOST} !^nrlcmd\.com$ [NC]
# RewriteRule ^(.*)$ https://nrlcmd.com/$1 [R=301,L]

# Force HTTPS
RewriteCond %{HTTPS} !=on
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

# Collapse multiple slashes (except protocol)
RewriteCond %{THE_REQUEST} \s/+([^\ ]*)
RewriteRule .* https://%{HTTP_HOST}/%1 [R=301,L]

# Strip disallowed query params globally
RewriteCond %{QUERY_STRING} (^|&)(utm_source|utm_medium|utm_campaign|utm_term|utm_content|ref|fbclid|gclid|msclkid|_hsmi|_hsenc)=[^&]* [NC]
RewriteRule ^ %{REQUEST_URI}? [R=301,L]

# Normalize directory-like URLs to trailing slash (not for file-like)
RewriteCond %{REQUEST_URI} !\.[a-zA-Z0-9]{2,5}$
RewriteCond %{REQUEST_URI} !/$
RewriteRule ^ %{REQUEST_URI}/ [R=301,L]

# Route all to index.php (front controller)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ index.php [L,QSA]
