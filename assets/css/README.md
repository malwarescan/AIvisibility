# CSS Architecture

## Design System Approach

This directory uses a **single authoritative stylesheet** pattern to prevent CSS sprawl and maintain control over styling.

## File Structure

### `design-system.css` (AUTHORITATIVE)
**✅ EDIT THIS FILE FOR ALL STYLE CHANGES**

This is the only file where new styles should be added or existing styles modified. It contains:
- Design tokens (CSS variables)
- Base element styles
- Layout primitives
- Components
- Utilities (limited)
- Overrides for legacy compatibility

### `styles.legacy.css` (FROZEN)
**❌ DO NOT EDIT THIS FILE**

Frozen copy of the original stylesheet. Loaded after `design-system.css` for backward compatibility. All legacy styles remain functional, but changes should be made in `design-system.css` instead.

## Loading Order

Stylesheets are loaded in this order (in `templates/head.php`):
1. `design-system.css` (new, authoritative)
2. `styles.legacy.css` (frozen, backward compatibility)

This ensures:
- New system overrides old styles when needed
- Old styles still work as fallback
- Zero breakage during migration

## Migration Strategy

### Making Changes

1. **Never edit `styles.legacy.css`**
2. Add overrides in `design-system.css` under the "OVERRIDES" section
3. Or refactor into proper component/utility structure

### Example Override

```css
/* In design-system.css */

/* Override legacy button style */
.button {
  background: var(--color-primary);
  /* ... new styles */
}
```

### Inline Styles

There are **148 inline `style=""` attributes** in the codebase that should be migrated to classes in `design-system.css` over time.

## Class Inventory

- **266 unique classes** are currently used across pages and templates
- All classes are catalogued and should be migrated systematically

## Migration Phases (DO NOT RUSH)

### ✅ Phase 0: Foundation (COMPLETE)
- ✅ Centralized style authority (design-system.css)
- ✅ Frozen legacy styles (styles.legacy.css)
- ✅ Established override precedence
- ✅ Documented rules
- ✅ Quantified problem (266 classes, 148 inline styles)

**Status: SUCCESSFUL FOUNDATION. Do not rush further.**

### ⏳ Phase 1: Inline Style Elimination (Next - High ROI, Low Risk)

**Goal:** Eliminate 148 inline styles by creating semantic classes

**Process:**
1. Pick top 10 most repeated inline patterns
2. Create semantic classes in design-system.css
3. Replace inline styles with classes
4. Do NOT touch legacy CSS

**Example:**
```css
/* design-system.css */
.text-muted {
  color: var(--color-text-muted);
  font-size: 0.875rem;
}
```

**Benefits:**
- Improves maintainability
- Improves CSP compatibility
- Enables agent/UI generation later

### ⏳ Phase 2: Component Promotion (Controlled)

**Only promote components that meet ALL three:**
- Used in ≥3 places
- Visually consistent
- Stable semantics

**Good first targets:**
- Buttons
- Cards
- Service grids
- Callout boxes

**Process:**
- Copy styles into design-system.css
- Override legacy behavior
- Leave legacy CSS untouched (shadowing, not migrating)

### ⏳ Phase 3: Token-Driven Redesign (The Payoff)

Because tokens exist, redesign entire site from:
```css
:root {
  --color-primary: …;
  --font-sans: …;
  --radius-md: …;
}
```

This enables:
- Redesign spacing
- Change typography
- Adjust color system
- Introduce light/dark variants
- Update entire website in one move

### ⏳ Phase 4: Legacy Deprecation (Months Later)

**Only after:**
- Inline styles = 0
- Core components promoted
- Legacy overrides no longer firing (Coverage confirms)

**Then:**
- Split legacy CSS by section
- Remove dead rules
- Eventually delete the file

**Timeline: Months, not days. That's fine.**

## What NOT to Do Next

❌ Start deleting legacy CSS  
❌ Refactor components + HTML at the same time  
❌ Mass-replace class names  
❌ "Clean up" utilities yet  
❌ Try to make it pretty all at once  

That's how projects stall or regress.

## Rules

- ✅ All changes go through `design-system.css`
- ❌ Never edit `styles.legacy.css`
- ✅ Use CSS variables from design tokens
- ✅ Follow the structure: Tokens → Base → Layout → Components → Utilities
- ✅ Work incrementally, one phase at a time
- ❌ Do not rush - foundation is complete, proceed methodically

## Why This Architecture Matters

This mirrors the SEO/agent architecture approach:
- Single source of truth
- Clear execution layer
- Frozen legacy behavior
- Deterministic overrides
- Instrumentation-ready

**This enables:**
- Let agents generate UI safely
- Theme pages programmatically
- A/B test layout tokens
- Apply fulfillment UI changes without refactors

**Design becomes infrastructure, not art.**

